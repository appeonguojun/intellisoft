$PBExportHeader$w_agreement_template_preview.srw
forward
global type w_agreement_template_preview from w_popup
end type
type ole_1 from u_email_edit within w_agreement_template_preview
end type
end forward

global type w_agreement_template_preview from w_popup
integer width = 4078
integer height = 2216
string title = "Agreement Template Preview"
boolean center = true
ole_1 ole_1
end type
global w_agreement_template_preview w_agreement_template_preview

type variables
string is_chapter[] = {"##","@@"}
string is_paragraph = "#.0"
string is_section = "#.#"

//WdFindWrap
Constant int wdFindAsk = 2 
Constant int wdFindContinue = 1 
Constant int wdFindStop = 0 

//WdReplace
Constant int wdReplaceAll = 2 
Constant int wdReplaceNone = 0 
Constant int wdReplaceOne = 1 

Constant int wdColorBlack = 0 //04.22.2008
end variables

forward prototypes
public function integer of_preview (string as_filename)
end prototypes

public function integer of_preview (string as_filename);integer i, j, li_chapter, li_paragraph, li_section
long ll_pos_paragraph,ll_pos_section, ll_cnt, ll_bookmark, ll_start,ll_end
string ls_mark,ls_replace
boolean lb_found_chapter, lb_found_paragraph, lb_found_section
oleobject lole_word
n_cst_word_utility lnv_word

if not fileexists(as_filename) then return -1
app_filler.of_set_word_safemode(false, 1) //Added By Ken.Guo 2015-07-30
If ole_1.object.doctype > 0 Then ole_1.object.ActiveDocument.Saved = True //Added By Ken.Guo 2016-05-23. workaround Task 524
ole_1.object.openlocalfile(as_filename,false)
app_filler.of_set_word_safemode(false, 0) //Added By Ken.Guo 2015-07-30
if ole_1.object.DocType < 1 then return -1
lole_word = ole_1.object.ActiveDocument
gnv_word_utility.of_modify_word_property( lole_word)	//Added By Mark Lee 06/20/2013 change for office 2013.
//-----------Begin Added By alfee on 04.22.2008---------
//Set default color property for hyperlink field
Boolean ib_changed = FALSE //04.22.2008
FOR i =  1 TO lole_word.Styles.Count
	IF lole_word.Styles.Item[i].NameLocal = "FollowedHyperlink" THEN
		lole_word.Styles.Item[i].Font.Color = wdColorBlack
		IF ib_changed THEN EXIT
		ib_changed = TRUE
	END IF
	IF lole_word.Styles.Item[i].NameLocal = "Hyperlink" THEN
		lole_word.Styles.Item[i].Font.Color = wdColorBlack
		IF ib_changed THEN EXIT
		ib_changed = TRUE
	END IF		
NEXT
//-----------End Added---------------------------------------

setpointer(HourGlass!)
this.setredraw(false)

lnv_word = create n_cst_word_utility
//auto numbering for document
lnv_word.of_preview(lole_word, True) 
destroy lnv_word

this.setredraw(true)


return 1
end function

on w_agreement_template_preview.create
int iCurrent
call super::create
this.ole_1=create ole_1
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.ole_1
end on

on w_agreement_template_preview.destroy
call super::destroy
destroy(this.ole_1)
end on

event open;call super::open;string ls_filename 

gnv_reg_ocx.of_check_ocx( 1,'', True) //1: office //Added by Ken.Guo on 2008-11-06

ls_filename = message.stringparm

if isnull(ls_filename) or len(trim(ls_filename)) < 1 then return -1

//preview template file
openwithparm( w_appeon_gifofwait, "Previewing template file ..." )
of_preview(ls_filename) 
if isvalid( w_appeon_gifofwait) then close(w_appeon_gifofwait)

//-----Begin Added by Alfee 05.28.2007 -----------------------
If isValid(w_agreement_template_painter) THEN
	w_agreement_template_painter.enabled = false
	w_agreement_template_painter.of_menu_security("others")
END If
//-----End Added ---------------------------------------------
end event

event pfc_preopen;call super::pfc_preopen;long ll_i
string ls_scale

This.of_SetResize(True)

This.inv_resize.of_SetOrigSize (This.workspacewidth(),This.workspaceheight())
ls_scale = this.inv_resize.scale

For ll_i =  1 To upperbound(This.CONTrol)
   This.inv_resize.of_Register (This.CONTrol[ll_i],ls_scale)
Next

end event

event close;call super::close;if isvalid(w_agreement_template_painter) then
		w_agreement_template_painter.enabled = true
		w_agreement_template_painter.of_menu_security("detail")
		w_agreement_template_painter.setfocus()
end if
end event

event activate;call super::activate;//Added By Ken.Guo 2011-05-05. Workaround Office OCX's bug
If gs_imageview_version = '5.0' and isvalid(ole_1 ) Then
	ole_1.object.activate(true)
End If
end event

event deactivate;call super::deactivate;//Added By Ken.Guo 2011-05-05. Workaround Office OCX's bug
//If gs_imageview_version = '5.0' and isvalid(ole_1 ) Then
//	ole_1.object.activate(false)
//End If
end event

type ole_1 from u_email_edit within w_agreement_template_preview
integer x = 23
integer y = 24
integer width = 3995
integer height = 2068
integer taborder = 20
string binarykey = "w_agreement_template_preview.win"
end type


Start of PowerBuilder Binary Data Section : Do NOT Edit
01w_agreement_template_preview.bin 
2400000c00e011cfd0e11ab1a1000000000000000000000000000000000003003e0009fffe000000060000000000000000000000010000000100000000000010000000000200000001fffffffe0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfffffffefffffffe00000004fffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff006f00520074006f004500200074006e00790072000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050016ffffffffffffffff000000010000000000000000000000000000000000000000000000000000000015b6a6a001d1b4bf00000003000002800000000000500003004f0042005800430054005300450052004d0041000000000000000000000000000000000000000000000000000000000000000000000000000000000102001affffffff00000002ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000011800000000004200500043004f00530058004f00540041005200450047000000000000000000000000000000000000000000000000000000000000000000000000000000000001001affffffffffffffff00000003d267e82f41ee8649010521915f71b1300000000015b6a6a001d1b4bf15b6a6a001d1b4bf0000000000000000000000000054004e004f004b0066004f0069006600650063007400430053006c006d0074000000000000000000000000000000000000000000000000000000000000000001020022ffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000005000001180000000000000001000000020000000300000004fffffffe00000006000000070000000800000009fffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
2Affffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1234abcd00005a550000356f8000001080000005800000088000001080000014010100010000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000010000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff000000000000000100c8d0d4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6e6d300e3ba9200000000000000000000000000000001000000000000000100000000000003a800000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000000000000010000000000000000000001310000001d000000000039701800000000000000000000002800000040002024ce000008f21234abcd00005a550000356f8000001080000005800000088000001080000014010100010000000000000000000000000000000000000000000000000000000000000001000000000000000000000001000000010000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff000000000000000100c8d0d4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6e6d300e3ba9200000000000000000000000000000001000000000000000100000000000003a800000001000000010000000100000001000000010000000100000001000000010000000100000001000000010000000100000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000057000057000ffacf0b26eed80b2037f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11w_agreement_template_preview.bin 
End of PowerBuilder Binary Data Section : No Source Expected After This Point
